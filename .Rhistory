Predicted_DF<-reshape2::melt(PredictionDf, id.vars = "Time")
Predicted_DF$type<-"Predicted"
Predicted_vs_Observed<-rbind(Internal_DF,Predicted_DF)
Predicted_vs_Observed$variable<-as.character(Predicted_vs_Observed$variable)
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Ambient.Temperature"] <- "Ambient Temperature"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Cooler.with.Ice"] <- "Cooler with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice"] <- "Tray with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice.Packs"] <- "Tray with Ice Packs"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Refrigerated.Tray"] <- "Refrigerated Tray"
#RMSE and Text
dat_text <- data.frame(
label = c("RMSE: 0.50", "RMSE: 0.58", "RMSE:0.63", "RMSE: 0.20", "RMSE: 0.27", "RMSE: 0.48"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,12.5),
y     = c(5, 2.5, 3.6,3.9,5.1,13)
)
dat_text_h <- data.frame(
label = c("Bias: 0.49", "Bias: -0.56", "Bias: 0.49", "Bias: 0.18", "Bias: 0.24", "Bias = -0.47"  ),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40, 12.5),
y     = c(3.5, 2.1, 2.7,3,3.8, 12)
)
dat_text$variable<-factor(dat_text$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
dat_text_h$variable<-factor(dat_text_h$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
Predicted_vs_Observed$variable<-factor(Predicted_vs_Observed$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
ggplot(Predicted_vs_Observed, aes(x = Time))+
#geom_point(aes(y = value, color = type))+
geom_line(aes(y = value, color = type, linetype = type), size=1)+
facet_wrap(~variable,scales = "free_y")+
theme_bw()+
labs(y = "Temperature (°C)", x = "Time (min)", color = "Observed vs Predicted",linetype = "Observed vs Predicted", title = "Testing Data")+
geom_text(data    = dat_text,
mapping = aes(x = x, y = y, label = label), size =3.5)+
geom_text(data    = dat_text_h,
mapping = aes(x = x, y = y, label = label), size =3.5)+
scale_color_manual(values = c("#00AFBB", "#FC4E07")) +
theme(legend.position="bottom")
ggsave("Figures/Testing Set Plot.jpg", width =8, height = 5, units = "in", dpi = 300)
Condition_Data<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_External_TestingData.csv")
Condition_Data_InternalMilk<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_Internal_TestingData.csv")
Predicted_RTB<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Ambient.Temperature, Initial_Temp = Condition_Data_InternalMilk$Ambient.Temperature[1], h_condition = h_RTB)
Predicted_RT<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigerated.Tray, Initial_Temp = Condition_Data_InternalMilk$Refrigerated.Tray[1], h_condition = h_RT)
Predicted_TI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice[1], h_condition = h_TIC)
Predicted_TIP<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice.Packs, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice.Packs[1], h_condition = h_TIP)
Predicted_CI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Cooler.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Cooler.with.Ice[1], h_condition = h_CI)
Predicted_ref<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigeration, Initial_Temp = Condition_Data_InternalMilk$Refrigeration[1], h_condition = h_ref)
calc_rmse(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
PredictionDf<-data.frame("Time" = c(1:60),
"Ambient.Temperature" = Predicted_RTB,
"Cooler.with.Ice" = Predicted_CI,
"Tray.with.Ice"= Predicted_TI,
"Tray.with.Ice.Packs"= Predicted_TIP,
"Refrigerated.Tray" = Predicted_RT,
"Refrigeration" = Predicted_ref)
Internal_DF<-reshape2::melt(Condition_Data_InternalMilk, id.vars = "Time")
Internal_DF$type<-"Observed"
Predicted_DF<-reshape2::melt(PredictionDf, id.vars = "Time")
Predicted_DF$type<-"Predicted"
Predicted_vs_Observed<-rbind(Internal_DF,Predicted_DF)
Predicted_vs_Observed$variable<-as.character(Predicted_vs_Observed$variable)
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Ambient.Temperature"] <- "Ambient Temperature"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Cooler.with.Ice"] <- "Cooler with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice"] <- "Tray with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice.Packs"] <- "Tray with Ice Packs"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Refrigerated.Tray"] <- "Refrigerated Tray"
#RMSE and Text
dat_text <- data.frame(
label = c("RMSE: 0.50", "RMSE: 0.58", "RMSE:0.63", "RMSE: 0.20", "RMSE: 0.27", "RMSE: 0.48"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,12.5),
y     = c(5, 2.5, 3.6,3.9,5.1,13)
)
dat_text_h <- data.frame(
label = c("Bias: 0.49", "Bias: -0.56", "Bias: 0.49", "Bias: 0.18", "Bias: 0.24", "Bias = -0.47"  ),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40, 12.5),
y     = c(3.5, 2.1, 2.7,3,3.8, 11.5)
)
dat_text$variable<-factor(dat_text$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
dat_text_h$variable<-factor(dat_text_h$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
Predicted_vs_Observed$variable<-factor(Predicted_vs_Observed$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
ggplot(Predicted_vs_Observed, aes(x = Time))+
#geom_point(aes(y = value, color = type))+
geom_line(aes(y = value, color = type, linetype = type), size=1)+
facet_wrap(~variable,scales = "free_y")+
theme_bw()+
labs(y = "Temperature (°C)", x = "Time (min)", color = "Observed vs Predicted",linetype = "Observed vs Predicted", title = "Testing Data")+
geom_text(data    = dat_text,
mapping = aes(x = x, y = y, label = label), size =3.5)+
geom_text(data    = dat_text_h,
mapping = aes(x = x, y = y, label = label), size =3.5)+
scale_color_manual(values = c("#00AFBB", "#FC4E07")) +
theme(legend.position="bottom")
ggsave("Figures/Testing Set Plot.jpg", width =8, height = 5, units = "in", dpi = 300)
Predicted_vs_Observed
Predicted_vs_Observed$variable
levels(Predicted_vs_Observed$variable)
Condition_Data<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_External_TestingData.csv")
Condition_Data_InternalMilk<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_Internal_TestingData.csv")
Predicted_RTB<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Ambient.Temperature, Initial_Temp = Condition_Data_InternalMilk$Ambient.Temperature[1], h_condition = h_RTB)
Predicted_RT<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigerated.Tray, Initial_Temp = Condition_Data_InternalMilk$Refrigerated.Tray[1], h_condition = h_RT)
Predicted_TI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice[1], h_condition = h_TIC)
Predicted_TIP<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice.Packs, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice.Packs[1], h_condition = h_TIP)
Predicted_CI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Cooler.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Cooler.with.Ice[1], h_condition = h_CI)
Predicted_ref<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigeration, Initial_Temp = Condition_Data_InternalMilk$Refrigeration[1], h_condition = h_ref)
calc_rmse(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
PredictionDf<-data.frame("Time" = c(1:60),
"Ambient.Temperature" = Predicted_RTB,
"Cooler.with.Ice" = Predicted_CI,
"Tray.with.Ice"= Predicted_TI,
"Tray.with.Ice.Packs"= Predicted_TIP,
"Refrigerated.Tray" = Predicted_RT,
"Refrigeration" = Predicted_ref)
Internal_DF<-reshape2::melt(Condition_Data_InternalMilk, id.vars = "Time")
Internal_DF$type<-"Observed"
Predicted_DF<-reshape2::melt(PredictionDf, id.vars = "Time")
Predicted_DF$type<-"Predicted"
Predicted_vs_Observed<-rbind(Internal_DF,Predicted_DF)
Predicted_vs_Observed$variable<-as.character(Predicted_vs_Observed$variable)
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Ambient.Temperature"] <- "Ambient Temperature"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Cooler.with.Ice"] <- "Cooler with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice"] <- "Tray with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice.Packs"] <- "Tray with Ice Packs"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Refrigerated.Tray"] <- "Refrigerated Tray"
#RMSE and Text
dat_text <- data.frame(
label = c("RMSE: 0.50", "RMSE: 0.58", "RMSE:0.63", "RMSE: 0.20", "RMSE: 0.27", "RMSE: 0.48"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,12.5),
y     = c(5, 2.5, 3.6,3.9,5.1,13)
)
dat_text_h <- data.frame(
label = c("Bias: 0.49", "Bias: -0.56", "Bias: 0.49", "Bias: 0.18", "Bias: 0.24", "Bias = -0.47"  ),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40, 12.5),
y     = c(3.5, 2.1, 2.7,3,3.8, 11.5)
)
dat_text$variable<-factor(dat_text$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
dat_text_h$variable<-factor(dat_text_h$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
Predicted_vs_Observed$variable<-factor(Predicted_vs_Observed$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
ggplot(Predicted_vs_Observed, aes(x = Time))+
#geom_point(aes(y = value, color = type))+
geom_line(aes(y = value, color = type, linetype = type), size=1)+
facet_wrap(~variable,scales = "free_y")+
theme_bw()+
labs(y = "Temperature (°C)", x = "Time (min)", color = "Observed vs Predicted",linetype = "Observed vs Predicted", title = "Testing Data")+
geom_text(data    = dat_text,
mapping = aes(x = x, y = y, label = label), size =3.5)+
geom_text(data    = dat_text_h,
mapping = aes(x = x, y = y, label = label), size =3.5)+
scale_color_manual(values = c("#00AFBB", "#FC4E07")) +
theme(legend.position="bottom")
levels(Predicted_vs_Observed$variable)
Condition_Data<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_External_TrainingData.csv")
Condition_Data_InternalMilk<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_Internal_TrainingData.csv")
Predicted_RTB<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Ambient.Temperature, Initial_Temp = Condition_Data_InternalMilk$Ambient.Temperature[1], h_condition = h_RTB)
Predicted_RT<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigerated.Tray, Initial_Temp = Condition_Data_InternalMilk$Refrigerated.Tray[1], h_condition = h_RT)
Predicted_TI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice[1], h_condition = h_TIC)
Predicted_TIP<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice.Packs, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice.Packs[1], h_condition = h_TIP)
Predicted_CI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Cooler.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Cooler.with.Ice[1], h_condition = h_CI)
Predicted_ref<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigeration, Initial_Temp = Condition_Data_InternalMilk$Refrigeration[1], h_condition = h_ref)
calc_rmse(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
PredictionDf<-data.frame("Time" = c(1:60),
"Ambient.Temperature" = Predicted_RTB,
"Cooler.with.Ice" = Predicted_CI,
"Tray.with.Ice"= Predicted_TI,
"Tray.with.Ice.Packs"= Predicted_TIP,
"Refrigerated.Tray" = Predicted_RT,
"Refrigeration" = Predicted_ref)
Internal_DF<-reshape2::melt(Condition_Data_InternalMilk, id.vars = "Time")
Internal_DF$type<-"Observed"
Predicted_DF<-reshape2::melt(PredictionDf, id.vars = "Time")
Predicted_DF$type<-"Predicted"
Predicted_vs_Observed<-rbind(Internal_DF,Predicted_DF)
Predicted_vs_Observed$variable<-as.character(Predicted_vs_Observed$variable)
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Ambient.Temperature"] <- "Ambient Temperature"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Cooler.with.Ice"] <- "Cooler with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice"] <- "Tray with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice.Packs"] <- "Tray with Ice Packs"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Refrigerated.Tray"] <- "Refrigerated Tray"
#RMSE and Text
dat_text <- data.frame(
label = c("RMSE: 0.32", "RMSE: 0.57", "RMSE:0.56", "RMSE: 0.60", "RMSE: 0.37", "RMSE: 0.09"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,17),
y     = c(4.5, 2.4, 2.9,3,3.8,12.5)
)
dat_text_h <- data.frame(
label = c("h: 3.10", "h: 0.50", "h: 1.56", "h: 1.44", "h: 2.83", "h = 3.88"  ),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 43, 40,40,40, 12.5),
y     = c(6, 2.75, 3.75,3.9,5.1, 14)
)
dat_text_bias <- data.frame(
label = c("Bias: -0.31", "Bias: -0.54", "Bias:-0.53", "Bias: -0.54", "Bias: -0.26", "Bias: 0.03"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,15),
y     = c(3, 2, 2,2.1,2.5,11)
)
dat_text$variable<-factor(dat_text$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
dat_text_h$variable<-factor(dat_text_h$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
#dat_text_bias$variable<-factor(dat_text_bias$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
Predicted_vs_Observed$variable<-factor(Predicted_vs_Observed$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
ggplot(Predicted_vs_Observed, aes(x = Time))+
#geom_point(aes(y = value, color = type))+
geom_line(aes(y = value, color = type, linetype = type), size=1)+
facet_wrap(~variable,scales = "free_y")+
theme_bw()+
labs(y = "Temperature (°C)", x = "Time (min)", color = "Observed vs Predicted",linetype = "Observed vs Predicted", title = "Training Data")+
geom_text(data    = dat_text,
mapping = aes(x = x, y = y, label = label), size =3.5)+
geom_text(data    = dat_text_h,
mapping = aes(x = x, y = y, label = label), size =3.5)+
scale_color_manual(values = c("#00AFBB", "#FC4E07")) +
geom_text(data = dat_text_bias,
mapping = aes(x = x, y = y, label = label), size =3.5) +
theme(legend.position="bottom")
levels(Predicted_vs_Observed$variable)
levels(dat_text_h$variable)
levels(dat_text_bias$variable)
Condition_Data<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_External_TrainingData.csv")
Condition_Data_InternalMilk<-read.csv("Bevier Trail Data/Bevier_Trial_Temps_Internal_TrainingData.csv")
Predicted_RTB<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Ambient.Temperature, Initial_Temp = Condition_Data_InternalMilk$Ambient.Temperature[1], h_condition = h_RTB)
Predicted_RT<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigerated.Tray, Initial_Temp = Condition_Data_InternalMilk$Refrigerated.Tray[1], h_condition = h_RT)
Predicted_TI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice[1], h_condition = h_TIC)
Predicted_TIP<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Tray.with.Ice.Packs, Initial_Temp = Condition_Data_InternalMilk$Tray.with.Ice.Packs[1], h_condition = h_TIP)
Predicted_CI<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Cooler.with.Ice, Initial_Temp = Condition_Data_InternalMilk$Cooler.with.Ice[1], h_condition = h_CI)
Predicted_ref<-predict_temp_fromProf(Time_Temp_Prof =Condition_Data$Refrigeration, Initial_Temp = Condition_Data_InternalMilk$Refrigeration[1], h_condition = h_ref)
calc_rmse(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_rmse(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Ambient.Temperature, predicted = Predicted_RTB[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigerated.Tray, predicted = Predicted_RT[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice, predicted = Predicted_TI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Tray.with.Ice.Packs, predicted = Predicted_TIP[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Cooler.with.Ice, predicted = Predicted_CI[1:60])
calc_bias(actual = Condition_Data_InternalMilk$Refrigeration, predicted = Predicted_ref[1:60])
PredictionDf<-data.frame("Time" = c(1:60),
"Ambient.Temperature" = Predicted_RTB,
"Cooler.with.Ice" = Predicted_CI,
"Tray.with.Ice"= Predicted_TI,
"Tray.with.Ice.Packs"= Predicted_TIP,
"Refrigerated.Tray" = Predicted_RT,
"Refrigeration" = Predicted_ref)
Internal_DF<-reshape2::melt(Condition_Data_InternalMilk, id.vars = "Time")
Internal_DF$type<-"Observed"
Predicted_DF<-reshape2::melt(PredictionDf, id.vars = "Time")
Predicted_DF$type<-"Predicted"
Predicted_vs_Observed<-rbind(Internal_DF,Predicted_DF)
Predicted_vs_Observed$variable<-as.character(Predicted_vs_Observed$variable)
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Ambient.Temperature"] <- "Ambient Temperature"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Cooler.with.Ice"] <- "Cooler with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice"] <- "Tray with Ice"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Tray.with.Ice.Packs"] <- "Tray with Ice Packs"
Predicted_vs_Observed$variable[Predicted_vs_Observed$variable == "Refrigerated.Tray"] <- "Refrigerated Tray"
#RMSE and Text
dat_text <- data.frame(
label = c("RMSE: 0.32", "RMSE: 0.57", "RMSE:0.56", "RMSE: 0.60", "RMSE: 0.37", "RMSE: 0.09"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,17),
y     = c(4.5, 2.4, 2.9,3,3.8,12.5)
)
dat_text_h <- data.frame(
label = c("h: 3.10", "h: 0.50", "h: 1.56", "h: 1.44", "h: 2.83", "h = 3.88"  ),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 43, 40,40,40, 12.5),
y     = c(6, 2.75, 3.75,3.9,5.1, 14)
)
dat_text_bias <- data.frame(
label = c("Bias: -0.31", "Bias: -0.54", "Bias:-0.53", "Bias: -0.54", "Bias: -0.26", "Bias: 0.03"),
variable   = c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"),
x     = c(40, 40, 40,40,40,15),
y     = c(3, 2, 2,2.1,2.5,11)
)
dat_text$variable<-factor(dat_text$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
dat_text_h$variable<-factor(dat_text_h$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
dat_text_bias$variable<-factor(dat_text_bias$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
Predicted_vs_Observed$variable<-factor(Predicted_vs_Observed$variable, levels= c("Ambient Temperature","Cooler with Ice","Tray with Ice","Tray with Ice Packs","Refrigerated Tray","Refrigeration"))
ggplot(Predicted_vs_Observed, aes(x = Time))+
#geom_point(aes(y = value, color = type))+
geom_line(aes(y = value, color = type, linetype = type), size=1)+
facet_wrap(~variable,scales = "free_y")+
theme_bw()+
labs(y = "Temperature (°C)", x = "Time (min)", color = "Observed vs Predicted",linetype = "Observed vs Predicted", title = "Training Data")+
geom_text(data    = dat_text,
mapping = aes(x = x, y = y, label = label), size =3.5)+
geom_text(data    = dat_text_h,
mapping = aes(x = x, y = y, label = label), size =3.5)+
scale_color_manual(values = c("#00AFBB", "#FC4E07")) +
geom_text(data = dat_text_bias,
mapping = aes(x = x, y = y, label = label), size =3.5) +
theme(legend.position="bottom")
ggsave("Figures/Training Set Plot.jpg", width =8, height = 5, units = "in", dpi = 300)
Actual_Temps<-read.csv("Validation Milk Temps.csv")
library(readr)
#breaks_base <- read_csv("School Breaks Data/Breaks_quant.csv")
breaks_base <- read_csv("School Breaks Data/Breaks_quant.csv")
breaks_base$breaks = as.factor(breaks_base$breaks)
breaks_base$lunches = as.factor(breaks_base$lunches)
library(tidyverse)
library(dplyr)
breaks_5 = breaks_base %>%
filter(breaks == "5")%>%
select(where(~ !any(is.na(.))))
breaks_4 = breaks_base %>%
filter(breaks == "4")%>%
select(where(~ !any(is.na(.))))
breaks_3 = breaks_base %>%
filter(breaks == "3")%>%
select(where(~ !any(is.na(.))))
breaks_2 = breaks_base %>%
filter(breaks == "2")%>%
select(where(~ !any(is.na(.))))
breaks_1 = breaks_base %>%
filter(breaks == "1")%>%
select(where(~ !any(is.na(.))))
breaks_0 = breaks_base %>%
filter(breaks == "0")%>%
select(where(~ !any(is.na(.))))
breaks_5
library(tidyr)
clean_1 = breaks_1 %>%
gather(type, time, L1:L2)%>%
mutate(type = recode(type, L1 = "Lunch", L2 = "Lunch", B1 = "Break"))
median(breaks_1$B1)
clean_2 = breaks_2 %>%
gather(type, time, L1:L3)%>%
mutate(type = recode(type, L1 = "Lunch", L2 = "Lunch", L3 = "Lunch", B1 = "Break", B2 = "Break"))
clean_3 = breaks_3 %>%
gather(type, time, L1:L4)%>%
mutate(type = recode(type, L1 = "Lunch", L2 = "Lunch", L3 = "Lunch", L4 = "Lunch", B1 = "Break", B2 = "Break", B3 = "Break"))
clean_4 = breaks_4 %>%
gather(type, time, L1:L5)%>%
mutate(type = recode(type, L1 = "Lunch", L2 = "Lunch", L3 = "Lunch", L4 = "Lunch", L5 = "Lunch", B1 = "Break", B2 = "Break", B3 = "Break", B4 = "Break"))
clean_5 = breaks_5 %>%
gather(type, time, L1:L6)%>%
mutate(type = recode(type, L1 = "Lunch", L2 = "Lunch", L3 = "Lunch", L4 = "Lunch", L5 = "Lunch", L6 = "Lunch", B1 = "Break", B2 = "Break", B3 = "Break", B4 = "Break", B5 = "Break"))
L1<-breaks_0 %>%
select(`...1`,L1) %>%
rename("Total_time" = "L1") %>%
mutate(type = "1 Lunch, No Breaks")
L2<-clean_1 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "2 Lunches, 1 Break")
L3<-clean_2 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "3 Lunches, 2 Breaks")
L4<-clean_3 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "4 Lunches, 3 Breaks")
L5<-clean_4 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "5 Lunches, 4 Breaks")
L6<-clean_5 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "6 Lunches, 5 Breaks")
All_Lunches<-rbind(L1,L2,L3,L4,L5,L6)
CreateAllFacet <- function(df, col){
df$facet <- df[[col]]
temp <- df
temp$facet <- "All combined"
merged <-rbind(temp, df)
# ensure the facet value is a factor
merged[[col]] <- as.factor(merged[[col]])
return(merged)
}
df <- CreateAllFacet(All_Lunches, "type")
ggplot(df, aes(x = Total_time))+
geom_histogram(aes(fill = type), color= "black")+
facet_wrap(~facet, scales = "free_x")+
theme(legend.position = c(0.8, 0.2))+
theme_bw()+
labs(x= "Time (min)", y = "Count (Schools)", fill= "No. Lunches, No. Breaks")
ggsave("Figures/Figure A- histograms_lunch.jpg", width =8, height = 6, units = "in", dpi = 300)
breaks_2$total_time<- rowSums(breaks_2[,6:10])
breaks_2_tot_time<-breaks_2 %>%
group_by(total_time) %>%
summarise(count = n()) %>%
arrange(total_time)
breaks_2_tot_time %>%
ggplot(aes(x = total_time, y = count))+
geom_col()
L1<-breaks_0 %>%
select(`...1`,L1) %>%
rename("Total_time" = "L1") %>%
mutate(type = "1 Lunch, No Breaks")
L2<-clean_1 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "2 Lunches, 1 Break")
L3<-clean_2 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "3 Lunches, 2 Breaks")
L4<-clean_3 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "4 Lunches, 3 Breaks")
L5<-clean_4 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "5 Lunches, 4 Breaks")
L6<-clean_5 %>%
group_by(`...1`) %>%
summarise(Total_time= sum(time))%>%
mutate(type = "6 Lunches, 5 Breaks")
All_Lunches<-rbind(L1,L2,L3,L4,L5,L6)
CreateAllFacet <- function(df, col){
df$facet <- df[[col]]
temp <- df
temp$facet <- "All combined"
merged <-rbind(temp, df)
# ensure the facet value is a factor
merged[[col]] <- as.factor(merged[[col]])
return(merged)
}
df <- CreateAllFacet(All_Lunches, "type")
ggplot(df, aes(x = Total_time))+
geom_histogram(aes(fill = type), color= "black")+
facet_wrap(~facet, scales = "free_x")+
theme(legend.position = c(0.8, 0.2))+
theme_bw()+
labs(x= "Time (min)", y = "Count (Schools)", fill= "No. Lunches, No. Breaks") +
theme(legend.position="bottom")
ggsave("Figures/Figure A- histograms_lunch.jpg", width =8, height = 6, units = "in", dpi = 300)
breaks_2$total_time<- rowSums(breaks_2[,6:10])
breaks_2_tot_time<-breaks_2 %>%
group_by(total_time) %>%
summarise(count = n()) %>%
arrange(total_time)
breaks_2_tot_time %>%
ggplot(aes(x = total_time, y = count))+
geom_col()
sum0 = breaks_0%>%
summarise(mean = round(mean(L1),0),median = median(L1), q10p = quantile(L1, 0.10), q90p =quantile(L1,0.90))%>%
mutate(NService = 1) %>%
mutate(type = "Lunch") %>%
select(type, NService, mean, median, q10p, q90p)
sum0
sum1 = clean_1 %>%
group_by(type)%>%
summarise(mean = round(mean(time),0),median = median(time), q10p = quantile(time, 0.10), q90p =quantile(time, 0.90))%>%
mutate(NService = 2) %>%
select(type, NService, mean, median, q10p, q90p)
sum1
sum2 = clean_2 %>%
group_by(type)%>%
summarise(mean = round(mean(time),0),median = median(time), q10p = quantile(time, 0.10), q90p =quantile(time, 0.90))%>%
mutate(NService = 3) %>%
select(type, NService, mean, median, q10p, q90p)
sum2
sum3 = clean_3 %>%
group_by(type)%>%
summarise(mean = round(mean(time),0),median = median(time), q10p = quantile(time, 0.10), q90p =quantile(time, 0.90))%>%
mutate(NService = 4) %>%
select(type, NService, mean, median, q10p, q90p)
sum3
sum4 = clean_4 %>%
group_by(type)%>%
summarise(mean = round(mean(time),0),median = median(time), q10p = quantile(time, 0.10), q90p =quantile(time, 0.90))%>%
mutate(NService = 5) %>%
select(type, NService, mean, median, q10p, q90p)
sum4
sum5 = clean_5 %>%
group_by(type)%>%
summarise(mean = round(mean(time),0), median = median(time), q10p = quantile(time, 0.10), q90p =quantile(time, 0.90)) %>%
mutate(NService = 6) %>%
select(type, NService, mean, median, q10p, q90p)
sum5
sum_all = rbind(sum0, sum1, sum2, sum3, sum4, sum5)
sum_all
